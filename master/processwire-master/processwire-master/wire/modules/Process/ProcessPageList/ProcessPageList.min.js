function ProcessPageListInit(){if(ProcessWire.config.ProcessPageList){$("#"+ProcessWire.config.ProcessPageList.containerID).ProcessPageList(ProcessWire.config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(c){var d={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:ProcessWire.config.urls.admin+"page/list/",ajaxMoveURL:ProcessWire.config.urls.admin+"page/sort/",paginationClass:"PageListPagination",paginationCurrentClass:"PageListPaginationCurrent",paginationLinkClass:"ui-state-default",paginationLinkCurrentClass:"ui-state-active",paginationHoverClass:"ui-state-hover",paginationDisabledClass:"ui-priority-secondary",openPagination:0,openPageIDs:[],openPageData:{},speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,spinnerMarkup:"<span class='PageListLoading'><i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i></span>",labelName:""};var b=[];var f=false;var e=a("body").hasClass("modal")||a("body").hasClass("pw-iframe");a.extend(d,c);return this.each(function(l){var v=a(this);var E;var u=a(d.spinnerMarkup);var G=0;var h=0;function y(){E=a("<div class='PageListRoot'></div>");if(v.is(":input")){d.selectedPageID=v.val();if(!d.selectedPageID.length){d.selectedPageID=0}d.mode="select";v.before(E);C()}else{d.mode="actions";v.append(E);m(d.rootPageID>0?d.rootPageID:1,E,0,true)}a(document).on("pageListRefresh",function(I,H){F(H)});if(d.useHoverActions){E.addClass("PageListUseHoverActions");o()}}function o(){var J=null;var K=null;var I=null;function H(M){var N=M.find(".PageListActions");if(!N.is(":visible")||M.hasClass("PageListItemOpen")){M.addClass("PageListItemHover");N.css("display","inline").css("opacity",0).animate({opacity:1},d.hoverActionFade)}}function L(M){var N=M.find(".PageListActions");M.removeClass("PageListItemHover");if(N.is(":visible")){N.animate({opacity:0},d.hoverActionFade,function(){N.hide()})}}a(document).on("keydown",".PageListItem",function(N){N=N||window.event;if(N.keyCode==0||N.keyCode==32){var M=a(this).find(".PageListActions");if(M.is(":visible")){M.css("display","none")}else{M.css("display","inline-block")}return false}});a(document).on("mouseover",".PageListItem",function(O){if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}I=a(this);if(I.hasClass("PageListItemHover")){return}var M=a(this);if(J){clearTimeout(J)}var N=d.hoverActionDelay;J=setTimeout(function(){if(I.attr("class")==M.attr("class")){if(!I.children("a:first").is(":hover")){return}var P=a(".PageListItemHover");H(I);P.each(function(){L(a(this))})}},N)}).on("mouseout",".PageListItem",function(O){if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return}var M=a(this);if(M.hasClass("PageListItemOpen")){return}if(!M.hasClass("PageListItemHover")){return}var N=d.hoverActionDelay*0.7;K=setTimeout(function(){if(M.is(":hover")){return}if(M.attr("class")==I.attr("class")){return}L(M)},N)})}function C(){var H=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var J=a("<p></p>").addClass("PageListSelectName");if(d.selectShowPageHeader){J.append(u)}var K=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(d.selectStartLabel).click(function(){if(a(this).text()==d.selectStartLabel){m(d.rootPageID>0?d.rootPageID:1,E,0,true);a(this).text(d.selectCancelLabel)}else{E.children(".PageList").slideUp(d.speed,function(){a(this).remove()});a(this).text(d.selectStartLabel)}return false});H.append(a("<li></li>").append(K));E.append(a("<div></div>").addClass("PageListSelectHeader").append(J).append(H));if(d.selectShowPageHeader){var I=d.ajaxURL+"?id="+d.selectedPageID+"&render=JSON&start=0&limit=0&lang="+d.langID+"&mode="+d.mode;if(d.labelName.length){I+="&labelName="+d.labelName}a.getJSON(I,function(N){var L="";if(d.selectShowPath){L=N.page.path;if(L.substring(-1)=="/"){L=L.substring(0,L.length-1)}L=L.substring(0,L.lastIndexOf("/")+1);L='<span class="detail">'+L+"</span> "}var M=d.selectedPageID>0?L+N.page.label:"";E.children(".PageListSelectHeader").find(".PageListSelectName").html(M)})}}function x(){f=false}function z(H,I,O,S){var Q=9;var J=Math.ceil(S/O);h=I>=O?Math.floor(I/O):0;if(h==0){G=0}else{if((h-Q+1)>G){G=h-Math.floor(Q/2)}else{if(G>0&&h==G){G=h-Math.ceil(Q/2)}}}if(G>J-Q){G=J-Q}if(G<0){G=0}var P=a("<ul></ul>").addClass(d.paginationClass).data("paginationInfo",{start:I,limit:O,total:S});var R=function(ab){var V=a(this).parents("ul."+d.paginationClass);var aa=V.data("paginationInfo");if(!aa){return false}var ac=parseInt(a(this).attr("href"))*aa.limit;if(ac===NaN){ac=0}var W=z(H,ac,aa.limit,aa.total);var Y=a(d.spinnerMarkup);var Z=a("<li>&nbsp;</li>").addClass(d.paginationDisabledClass).append(Y.hide());V.siblings(".PageList").remove();V.replaceWith(W);W.append(Z);Y.fadeIn("fast");var X=W.siblings().css("opacity",0.5);m(H,W.parent(),a(this).attr("href")*aa.limit,false,false,true,function(){Y.fadeOut("fast",function(){Z.remove()});W.parent(".PageList").prev(".PageListItem").data("start",ac);g()});return false};var N=null;var K=null;for(var U=G,L=0;U<J;U++,L++){var M=a("<a></a>").html(U+1).attr("href",U).addClass(d.paginationLinkClass);var T=a("<li></li>").addClass(d.paginationClass+L).append(M);if(U==h){T.addClass(d.paginationCurrentClass).find("a").removeClass(d.paginationLinkClass).addClass(d.paginationLinkCurrentClass)}P.append(T);if(!K){K=T.clone().removeClass(d.paginationCurrentClass+" "+d.paginationLinkCurrentClass);K.find("a").removeClass(d.paginationLinkCurrentClass).addClass(d.paginationLinkClass)}if(!N){N=K.clone().removeClass(d.paginationLinkClass).addClass(d.paginationDisabledClass).html("&hellip;")}if(L>=Q&&U<J){$lastItem=K.clone();$lastItem.find("a").text(J).attr("href",J-1);P.append(N.clone()).append($lastItem);break}}if(G>0){$firstItem=K.clone();$firstItem.find("a").text("1").attr("href","0").click(R);P.prepend(N.clone()).prepend($firstItem)}if(h+1<J){$nextBtn=K.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",h+1);P.append($nextBtn)}if(h>0){$prevBtn=K.clone();$prevBtn.find("a").attr("href",h-1).html("<i class='fa fa-angle-left'></i>");P.prepend($prevBtn)}P.find("a").click(R).hover(function(){a(this).addClass(d.paginationHoverClass)},function(){a(this).removeClass(d.paginationHoverClass)});return P}function m(I,L,J,N,Q,K,P){if(Q==undefined){Q=true}if(K==undefined){K=false}var M=function(V){if(V&&V.error){ProcessWire.alert(V.message);u.hide();f=false;return}var R=k(a(V.children));var U=V.start+V.limit;if(V.page.numChildren>U){var T=a("<a></a>").attr("href",U).data("pageId",I).text(d.moreLabel).click(B);R.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(T)))}if(Q&&(V.page.numChildren>U||V.start>0)){R.prepend(z(I,V.start,V.limit,V.page.numChildren))}R.hide();if(N){var W;W=k(a(V.page));if(d.showRootPage){W.children(".PageListItem").addClass("PageListItemOpen")}else{W.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}W.append(R);L.append(W)}else{if(L.is(".PageList")){var S=R.children(".PageListItem, .PageListActions");if(K){L.children(".PageListItem, .PageListActions").replaceWith(S)}else{L.append(S)}}else{L.after(R)}}if(u.parent().is(".PageListRoot")){u.hide()}else{u.fadeOut("fast")}if(K){R.show();x();if(P!=undefined){P()}}else{R.slideDown(d.speed,function(){x();if(P!=undefined){P()}})}R.prev(".PageListItem").data("start",V.start);L.removeClass("PageListForceReload")};if(!K){L.append(u.fadeIn("fast"))}var O=I+"-"+J;if(typeof d.openPageData[O]!="undefined"&&!L.hasClass("PageListID7")&&!L.hasClass("PageListForceReload")){M(d.openPageData[O]);return}var H=d.ajaxURL+"?id="+I+"&render=JSON&start="+J+"&lang="+d.langID+"&open="+d.openPageIDs[0]+"&mode="+d.mode;if(d.labelName.length){H+="&labelName="+d.labelName}a.getJSON(H).done(function(S,T,R){M(S)}).fail(function(R,T,S){M({error:1,message:!R.status?d.ajaxNetworkError:d.ajaxUnknownError})})}function k(H){var J=a("<div></div>").addClass("PageList");var I=J;H.each(function(L,K){I.append(j(K))});s(I);return J}function s(H){a("a.PageListPage",H).click(t);a(".PageListActionMove a",H).click(i);a(".PageListActionSelect a",H).click(A);a(".PageListTriggerOpen:not(.PageListID1) > a.PageListPage",H).click();a(".PageListActionExtras > a:not(.clickExtras)",H).addClass("clickExtras").on("click",p)}function j(N){var M=a("<div></div>").data("pageId",N.id).addClass("PageListItem").addClass("PageListTemplate_"+N.template);var L=a("<a></a>").attr("href","#").attr("title",N.path).html(N.label).addClass("PageListPage label");M.addClass("PageListID"+N.id);if(N.status==0){M.addClass("PageListStatusOff disabled")}if(N.status&2048){M.addClass("PageListStatusUnpublished secondary")}if(N.status&1024){M.addClass("PageListStatusHidden secondary")}if(N.status&512){M.addClass("PageListStatusTemp secondary")}if(N.status&16){M.addClass("PageListStatusSystem")}if(N.status&8){M.addClass("PageListStatusSystem")}if(N.status&4){M.addClass("PageListStatusLocked")}if(N.addClass&&N.addClass.length){M.addClass(N.addClass)}if(N.type&&N.type.length>0){if(N.type=="System"){M.addClass("PageListStatusSystem")}}a(d.openPageIDs).each(function(P,O){O=parseInt(O);if(N.id==O){M.addClass("PageListTriggerOpen")}});M.append(L);var J=a("<span>"+(N.numChildren?N.numChildren:"")+"</span>").addClass("PageListNumChildren detail");M.append(J);if(N.note&&N.note.length){M.append(a("<span>"+N.note+"</span>").addClass("PageListNote detail"))}var K=a("<ul></ul>").addClass("PageListActions actions");var I=d.rootPageID==N.id?[]:[{name:d.selectSelectLabel,url:d.selectSelectHref}];if(d.mode=="actions"){I=N.actions}else{if(d.selectAllowUnselect){if(N.id==v.val()){I=[{name:d.selectUnselectLabel,url:d.selectUnselectHref}]}}}var H=null;a(I).each(function(S,Q){var O;if(Q.name==d.selectSelectLabel){O="Select"}else{if(Q.name==d.selectUnselectLabel){O="Select"}else{O=Q.cn}}var P=a("<a></a>").html(Q.name).attr("href",Q.url);if(!e){if(Q.cn=="Edit"){P.addClass("pw-modal pw-modal-large pw-modal-longclick");P.attr("data-buttons","#ProcessPageEdit > .Inputfields > .InputfieldSubmit .ui-button")}else{if(Q.cn=="View"){P.addClass("pw-modal pw-modal-large pw-modal-longclick")}}}if(typeof Q.extras!="undefined"){P.data("extras",Q.extras)}var R=a("<li></li>").addClass("PageListAction"+O).append(P);if(O=="Extras"){H=R}else{K.append(R)}});if(H){K.append(H);H.addClass("ui-priority-secondary")}M.append(K);return M}function p(O){var I=a(this);var K=I.data("extras");if(typeof K=="undefined"){return false}var R=I.closest(".PageListItem");var S=I.closest(".PageListActions");var M=null;var P=I.children("i.fa");var Q=S.find("li.PageListActionExtra");P.toggleClass("fa-flip-horizontal");if(Q.length){Q.fadeOut(100,function(){Q.remove()});return false}for(var J in K){var H=K[J];var N=a("<a />").addClass("PageListActionExtra PageListAction"+H.cn).attr("href",H.url).html(H.name);if(typeof H.ajax!="undefined"&&H.ajax==true){N.click(function(){R.find(".PageListActions").hide();var Z=a(d.spinnerMarkup);var W=a(this).attr("href");var V=W.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var U=parseInt(W.match(/[\?&]id=([0-9]+)/)[1]);var Y=a("#PageListContainer").attr("data-token-name");var X=a("#PageListContainer").attr("data-token-value");var T={action:V,id:U};T[Y]=X;R.append(Z);a.post(W+"&render=json",T,function(aa){if(aa.success){R.fadeOut("fast",function(){var ag=false;var ah=aa.remove;var af=aa.refreshChildren;var ad=false;if(typeof aa.child!="undefined"){ad=j(aa.child)}else{if(typeof aa.newChild!="undefined"){ad=j(aa.newChild);ag=true}}if(ad){var ab=a("<span />").addClass("notes").html(aa.message);ab.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");ad.append(ab);s(ad)}if(ag){Z.fadeOut("normal",function(){Z.remove()});ad.hide();R.after(ad);ad.slideDown()}else{if(ad){if(R.hasClass("PageListItemOpen")){ad.addClass("PageListItemOpen")}R.replaceWith(ad)}}R.fadeIn("fast",function(){setTimeout(function(){ab.fadeOut("normal",function(){if(ah){var ai=ad.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(ai.length){var aj=parseInt(ai.text());if(aj>0){ai.text(aj-1)}}ad.next(".PageList").fadeOut("fast");ad.fadeOut("fast",function(){ad.remove()})}else{ab.remove()}})},1000)});if(af){var ac=a(".PageListID"+af);if(ac.length){ac.addClass("PageListForceReload");var ae=ac.children("a.PageListPage");if(ac.hasClass("PageListItemOpen")){ae.click();setTimeout(function(){ae.click()},250)}else{ae.click()}}}})}else{Z.remove();ProcessWire.alert(aa.message)}});return false})}else{}var L=a("<li />").addClass("PageListActionExtra PageListAction"+H.cn).append(N);N.hide();if(H.cn=="Trash"){R.addClass("trashable");M=L}else{S.append(L)}}if(M){S.append(M)}S.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function t(K){var O=a(this);var N=O.parent(".PageListItem");var M=N.data("pageId");if(f&&!N.hasClass("PageListTriggerOpen")){return false}if(E.is(".PageListSorting")||E.is(".PageListSortSaving")){return false}if(N.hasClass("PageListItemOpen")){var H=true;if(N.hasClass("PageListID1")&&!N.hasClass("PageListForceReload")&&d.mode!="select"){var I=a(this).closest(".PageListRoot").find(".PageListItemOpen:not(.PageListID1)");if(I.length){E.find(".PageListItemOpen:not(.PageListID1)").each(function(){a(this).children("a.PageListPage").click()});H=false}}if(H){N.removeClass("PageListItemOpen").next(".PageList").slideUp(d.speed,function(){a(this).remove()})}}else{N.addClass("PageListItemOpen");var J=parseInt(N.children(".PageListNumChildren").text());if(J>0||N.hasClass("PageListForceReload")){f=true;var L=D(M);m(M,N,L,false)}}if(d.mode!="select"){setTimeout(function(){g()},250)}return false}function D(L){var K=0;for(n=0;n<d.openPageIDs.length;n++){var I=d.openPageIDs[n];if(I.indexOf("-")==-1){continue}var J=d.openPageIDs[n].split("-");var H=parseInt(J[0]);if(H==L){K=parseInt(J[1]);break}}return K}function g(){b=[];a(".PageListItemOpen").each(function(){var I=a(this).data("pageId");var H=a(this).data("start");if(typeof H=="undefined"||H===null){H=0}else{var H=parseInt(H)}if(jQuery.inArray(I,b)==-1){b.push(I+"-"+H)}});a.cookie("pagelist_open",b)}function F(N,I){var L=a(".PageListID"+N).parent(".PageList");var O=L.prev(".PageListItem");if(!O.length){return}var P=O.attr("class").match(/PageListID(\d+)/)[1];var H=0;var M=L.children("ul."+d.paginationClass);var Q=M.data("paginationInfo");var K=null;if(Q){var J=M.find(".pw-link-active");if(J.length){H=parseInt(J.attr("href"))*Q.limit}if(H===NaN){H=0}}if(P==1){K=L.children();L=O}L.addClass("PageListForceReload");m(P,L,H,false,true,true,function(){if(K&&K.length){K.remove()}})}function B(K){var M=a(this);var I=M.parent("li").parent("ul.PageListActions");var H=I.parent(".PageList");var L=M.data("pageId");var J=parseInt(M.attr("href"));m(L,H,J,false);I.remove();return false}function i(){if(f){return false}var N=a(this);if(a(".PageListItem:visible").length==1){N.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var M=N.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(M.hasClass("PageListItemOpen")){M.children(".PageListPage").click()}E.find(".PageListItemOpen").each(function(){var P=a(this).children(".PageListNumChildren").text();if(parseInt(P)>1&&a(this).next().find(".PageList:visible").size()==0){return}var O=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");O.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(O)});var L={stop:q,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(P,O){a(".PageListSortPlaceholder").css("width",O.item.children(".PageListPage").outerWidth()+"px")}};var I=E.children(".PageList").children(".PageList");var H=a("<a href='#'>"+d.selectCancelLabel+"</a>").click(function(){return r(M)});var K=M.children("ul.PageListActions");var J=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+d.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");J.append(H);K.before(J);M.addClass("PageListSortItem");M.parent(".PageList").attr("id","PageListMoveFrom");E.addClass("PageListSorting");I.addClass("PageListSortingList").sortable(L);return false}function r(I){var H=E.find(".PageListSortingList");H.sortable("destroy").removeClass("PageListSortingList");I.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");I.find(".PageListMoveNote").remove();E.find(".PageListPlaceholder").remove();E.removeClass("PageListSorting");return false}function w(K){var H=E.find(".PageListID"+d.trashPageID);if(!H.hasClass("PageListItemOpen")){E.removeClass("PageListSorting");H.children("a").click();E.addClass("PageListSorting")}var I=H.next(".PageList");if(I.length==0){I=a("<div class='PageList'></div>");H.after(I)}I.prepend(K);var J={item:K};q(null,J)}function q(N,S){var P=S.item;var K=P.children(".PageListPage");var I=parseInt(P.data("pageId"));var M=P.parent(".PageList");var Q=a("#PageListMoveFrom");var R=M.prev().is(".PageListItem")?M.prev():M.prev().prev();var O=parseInt(R.data("pageId"));var J=P.prev(".PageListItem");if(J.is(".PageListItemOpen")){return false}if(M.is(".PageListPlaceholder")){M.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}E.addClass("PageListSortSaving");r(P);P.append(u.fadeIn("fast"));var L="";M.children(".PageListItem").each(function(){L+=a(this).data("pageId")+","});var H={id:I,parent_id:O,sort:L};H[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var T="unknown";a.post(d.ajaxMoveURL,H,function(W){u.fadeOut("fast");K.fadeOut("fast",function(){a(this).fadeIn("fast");P.removeClass("PageListSortItem");E.removeClass("PageListSorting")});if(W&&W.error){ProcessWire.alert(W.message)}if(!M.is("#PageListMoveFrom")){var V=Q.prev(".PageListItem");var U=V.children(".PageListNumChildren");var Y=U.text().length>0?parseInt(U.text())-1:0;if(Y==0){Y="";Q.remove()}U.text(Y);var X=M.prev(".PageListItem");U=X.children(".PageListNumChildren");Y=U.text().length>0?parseInt(U.text())+1:1;U.text(Y)}Q.attr("id","");E.removeClass("PageListSortSaving")},"json");P.trigger("pageMoved");return true}function A(){var N=a(this);var M=N.parent("li").parent("ul.PageListActions").parent(".PageListItem");var L=M.data("pageId");var J=M.children(".PageListPage");var K=J.text();var I=J.attr("title");var H=E.children(".PageListSelectHeader");if(N.text()==d.selectUnselectLabel){L=0;K=""}if(L!=v.val()){v.val(L).change()}if(d.selectShowPageHeader){H.children(".PageListSelectName").text(K)}v.trigger("pageSelected",{id:L,url:I,title:K,a:J});H.find(".PageListSelectActionToggle").click();if(d.selectSelectHref=="#"){return false}return true}y()})}})(jQuery);