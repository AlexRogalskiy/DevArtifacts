!function() {
    function sendRequest(id, name) {
        FB.ui({
            method: "apprequests",
            title: "Hey! I started a game against you on CheSS.js",
            to: id,
            message: "Hey " + name + ", I'll beat you!"
        }, function(response) {
            response && response.request && (window.location = "/chess/create/" + response.request + "/" + id);
        });
    }
    $(".challenger").on("click", function(ev) {
        ev.preventDefault();
        var $me = $(this);
        sendRequest($me.attr("data-id"), $me.attr("data-name"));
    }), $(".users-box .form-search").on("keyup", ".search-input", function() {
        var $me = $(this), $userBox = $me.parents(".users-box"), val = $me.val();
        val ? ($userBox.find("li[data-name]").hide(), $userBox.find('li[data-name*="' + val.toLowerCase() + '"]').show()) : $userBox.find("li[data-name]").show();
    });
    var checkGames = function() {
        $.ajax({
            url: "/chess/_/checkGames",
            type: "POST",
            success: function(response) {
                for (var i = 0, x = response.length; x > i; i++) 0 === $("#" + response[i]).length && window.location.reload();
            }
        });
    };
    setInterval(checkGames, 5e3);
}();